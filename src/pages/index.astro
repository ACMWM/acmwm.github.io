---
import Layout from '@layouts/Default.astro';
import { getEventsFromSheets } from "../scripts/googleSheets";
import '../styles/home.css';

const events = await getEventsFromSheets(false);

// Logic updated to pull top 3 candidates to match the '3 card' layout in the image
const spotlightCandidates = events.filter((e) => e.featured);
const featuredEvents = (spotlightCandidates.length ? spotlightCandidates : events).slice(0, 3);

const fmt = new Intl.DateTimeFormat("en-US", {
  weekday: "short",
  month: "short",
  day: "numeric",
  year: "numeric",
  hour: "numeric",
  minute: "2-digit",
});

const socialIcons = [
  {
    name: 'GitHub',
    url: 'https://code.wm.edu/rdryder/acm-workshops',
    icon: 'i-uil-github',
  },
  {
    name: 'Instagram',
    url: 'https://www.instagram.com/acmwm/',
    icon: 'i-uil-instagram',
  },
  { name: 'RSS', url: '/feed.xml', icon: 'i-uil-rss' },
];
---

<Layout
  title='Home'
  pageTitle='W&M ACM Student Chapter'
  description='The W&M ACM chapter Website.'
>
  <main class="home-container">
    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title">W&M ACM</h1>
        <p class="hero-subtitle">Association for Computing Machinery Student Chapter</p>
        
        <div class="hero-buttons">
          <a href="#socials" class="btn btn-primary">Join us</a>
          <button class="btn btn-blank" disabled>&nbsp;</button>
          <a href="/about" class="btn btn-secondary">Learn more</a>
        </div>
      </div>
    </section>

    <section class="events-section">
      <h2 class="section-title">Featured Events</h2>
      
      <div class="events-grid">
        {featuredEvents.length > 0 ? (
          featuredEvents.map((event) => (
            <div class="event-card">
              <div class="card-header">
                <h3 class="event-title">{event.name}</h3>
                <span class="event-type">{event.type || 'Event'}</span>
              </div>
              
              <div class="card-body">
                {event.date && (
                  <div class="event-meta">
                    <span class="icon-time">üìÖ</span>
                    {fmt.format(event.date)}
                  </div>
                )}
                {event.location && (
                  <div class="event-meta">
                    <span class="icon-pin">üìç</span>
                    {event.location}
                  </div>
                )}
                
                {event.blurb && <p class="event-blurb">{event.blurb}</p>}
                
                {(event.hostingClubs?.length ?? 0) > 0 && (
                  <div class="club-tags">
                    {event.hostingClubs.map((c) => (
                      <span class="club-tag">{c}</span>
                    ))}
                  </div>
                )}
              </div>
            </div>
          ))
        ) : (
          <p class="no-events">No upcoming events right now.</p>
        )}
      </div>

      <div class="events-footer">
        <a href="/events" class="see-all-link">See all events &rarr;</a>
      </div>
    </section>

    <section id="socials" class="socials-section">
      <h3>Connect with us</h3>
      <div class="social-icons-container">
        {socialIcons.map((item) => (
          <a
            href={item.url}
            target="_blank"
            rel="noopener noreferrer"
            class="social-icon-link"
            title={`See W&M ACM on ${item.name}`}
          >
            <div class:list={[item.icon, 'social-icon']} />
            <span class="sr-only">{item.name}</span>
          </a>
        ))}
      </div>
    </section>
  </main>
</Layout>